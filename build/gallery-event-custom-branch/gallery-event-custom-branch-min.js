YUI.add("gallery-event-custom-branch",function(a){(function(f){var e=f.CustomEvent.prototype,c=e.applyConfig,b=Math.max,d=f.mix;d(e,{applyConfig:function(g,h){c.apply(this,arguments);if(g){d(this,g,h,["branchPreventedFn","branchStoppedFn"]);}},fireComplex:function(m){var q,t,u,w,i,h,v,p=this,k,o,g,l,s,r=p.stack,j,n=p.type;if(r){if(p.queuable&&n!==r.next.type){p.log("queue "+n);r.queue.push([p,m]);return true;}}i=r||{afterQueue:new f.Queue(),branchPrevented:0,branchStopped:0,bubbling:null,defaultTargetOnly:p.defaultTargetOnly,id:p.id,next:p,prevented:0,queue:[],silent:p.silent,stopped:0,type:n};t=n!==i.type;v=p.host||p;j=p.getSubs();p.branchPrevented=t?0:i.branchPrevented;p.branchStopped=t?0:i.branchStopped;p.stopped=t?0:i.stopped;p.prevented=t?0:i.prevented;p.target=p.target||v;w=new f.EventTarget({fireOnce:true,context:v});if(p.branchStoppedFn){w.on("branchStopped",p.branchStoppedFn);}if(p.stoppedFn){w.on("stopped",p.stoppedFn);}p.currentTarget=v;p.details=m.slice();p.events=w;p.log("Firing "+n);p._facade=null;u=p._getFacade(m);if(f.Lang.isObject(m[0])){m[0]=u;}else{m.unshift(u);}if(j[0]){p._procSubs(j[0],m,u);}if(p.bubbles&&v.bubble&&!p.branchStopped&&!p.stopped){o=i.bubbling;i.bubbling=n;if(t){i.branchPrevented=0;i.branchStopped=0;i.prevented=0;i.stopped=0;}v.bubble(p,m,null,i);p.branchPrevented=b(p.branchPrevented,i.branchPrevented);p.branchStopped=b(p.branchStopped,i.branchStopped);p.prevented=b(p.prevented,i.prevented);p.stopped=b(p.stopped,i.stopped);i.bubbling=o;}if(p.prevented&&p.preventedFn){p.preventedFn.apply(v,m);}if(p.branchPrevented){if(p.branchPreventedFn){p.branchPreventedFn.apply(v,m);}}else{if(p.defaultFn&&(!(p.defaultTargetOnly||i.defaultTargetOnly)||v===u.target)){p.defaultFn.apply(v,m);}}p._broadcast(m);if(j[1]&&!p.branchPrevented&&p.branchStopped<2&&p.stopped<2){h=i.afterQueue;if(i.id===p.id||n!==v._yuievt.bubbling){p._procSubs(j[1],m,u);while((k=h.last())){k();}}else{g=j[1];if(i.execDefaultCnt){g=f.merge(g);f.each(g,function(x){x.postponed=true;});}h.add(function(){p._procSubs(g,m,u);});}}p.target=null;if(i.id===p.id){l=i.queue;while(l.length){s=l.pop();q=s[0];i.next=q;q.fire.apply(q,s[1]);}p.stack=null;}if(n!==v._yuievt.bubbling){i.branchPrevented=0;i.branchStopped=0;i.prevented=0;i.stopped=0;p.branchPrevented=0;p.branchStopped=0;p.prevented=0;p.stopped=0;}return !p.stopped;},haltBranch:function(g){var h=this;if(g){h.stopImmediateBranchPropagation();}else{h.stopBranchPropagation();}h.preventBranchDefault();},preventBranchDefault:function(){var g=this,h=g.stack;if(g.preventable){g.branchPrevented=1;if(h){h.branchPrevented=1;}}},preventDefault:function(){var g=this,h=g.stack;g.preventBranchDefault();if(g.preventable){g.prevented=1;if(h){h.prevented=1;}}},resetBranch:function(){var g=this,h=g.stack;g.branchPrevented=0;g.branchStopped=0;if(h){h.branchPrevented=0;h.branchStopped=0;}},stopBranchPropagation:function(){var g=this,h=g.stack;g.branchStopped=1;if(h){h.branchStopped=1;}g.events.fire("branchStopped",g);},stopImmediateBranchPropagation:function(){var g=this,h=g.stack;g.branchStopped=2;if(h){h.branchStopped=2;}g.events.fire("branchStopped",g);},_notify:function(h,g){var i=this;i.log(i.type+"->"+"sub: "+h.id);if(h.notify(g,i)===false){i.stopped=2;}if(i.branchStopped>1||i.stopped>1){i.log(i.type+" cancelled by subscriber");return false;}return true;},_procSubs:function(k,g){var j,h;for(h in k){if(k.hasOwnProperty(h)){j=k[h];if(j&&j.fn){if(!this._notify(j,g)){return false;}}}}return true;}},true);d(f.EventFacade.prototype,{haltBranch:function(g){var h=this;h._event.haltBranch(g);h.prevented=1;h.branchStopped=g?2:1;},preventBranchDefault:function(){this._event.preventBranchDefault();this.branchPrevented=1;},preventDefault:function(){var g=this;g.preventBranchDefault();g._event.preventDefault();g.prevented=1;},resetBranch:function(){var g=this;g._event.resetBranch();g.branchPrevented=0;g.branchStopped=0;},stopBranchPropagation:function(){this._event.stopBranchPropagation();this.branchStopped=1;},stopImmediateBranchPropagation:function(){this._event.stopImmediateBranchPropagation();this.branchStopped=2;}},true);d(f.EventTarget.prototype,{bubble:function(h,s,r,n){var q,j,m=this._yuievt.targets,v,p,o,u,l=h&&h.branchPrevented,k=r||(h&&h.target)||this,g=true,t=h&&h.type;if(!h||h.resetBranch()||!h.stopped&&m){for(o in m){if(m.hasOwnProperty(o)){j=m[o];v=j.getEvent(t,true);p=j.getSibling(t,v);if(p&&!v){v=j.publish(t);}u=j._yuievt.bubbling;j._yuievt.bubbling=t;if(!v){if(j._yuievt.hasTargets){j.bubble(h,s,k,n);}}else{v.sibling=p;v.target=k;v.originalTarget=k;v.currentTarget=j;q=v.broadcast;v.broadcast=false;v.emitFacade=true;v.stack=n;g=g&&v.fire.apply(v,s||h.details||[]);v.broadcast=q;v.originalTarget=null;v.resetBranch();if(v.stopped){break;}}j._yuievt.bubbling=u;}}if(l){h.preventBranchDefault();}}return g;}},true);}(a));},"@VERSION@",{requires:["event-custom-complex"],skinnable:false});