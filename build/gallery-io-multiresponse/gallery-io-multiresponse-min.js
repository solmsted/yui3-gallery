YUI.add("gallery-io-multiresponse",function(a){var i=a.Lang,j=a.config.win,g=a.config.doc,e=(g.documentMode&&g.documentMode>=8),f=decodeURIComponent;function k(m,p,n){var d=a.Node.create('<iframe id="io-multi-response-'+m.id+'" name="io-multi-response-'+m.id+'" />');d._node.style.position="absolute";d._node.style.top="-1000px";d._node.style.left="-1000px";a.one("body").appendChild(d);a.on("load",function(){n._multi_complete(m,p);},"#io-multi-response-"+m.id);}function l(n){var m=a.guid("io-multi-response-form-"),d=a.Node.create('<form id="'+m+'" name="'+m+'" />');d._node.style.position="absolute";d._node.style.top="-1000px";d._node.style.left="-1000px";a.one("body").appendChild(d);return m;}a.mix(a.IO.prototype,{_addJSON:function(n,m){if(!a.Lang.isString(m)){m=a.JSON.stringify(m);}var d=g.createElement("input");d.type="hidden";d.name="json";d.value=m;n.appendChild(d);return d;},_multi_setAttrs:function(m,o,d,n){m.setAttribute("action",d);m.setAttribute("method",n||"POST");m.setAttribute("target","io-multi-response-"+o);m.setAttribute(a.UA.ie&&!e?"encoding":"enctype","multipart/form-data");},_multi_startTimeout:function(d,n){var m=this;m._timeout[d.id]=j.setTimeout(function(){d.status=0;d.statusText="timeout";m.end(d,n);},n.timeout);},_multi_destroy:function(m,d){if(!d.debug){a.Event.purgeElement("#io-multi-response-"+m,false);a.one("body").removeChild(a.one("#io-multi-response-"+m));}if(d.form.id.indexOf("io-multi-response-form-")===0){a.one("body").removeChild(a.one("#"+d.form.id));}},_multi_complete:function(d,n){var m=this;if(n.timeout){m._clearTimeout(d.id);}m.end(d,n);j.setTimeout(function(){m._multi_destroy(d.id,n);},0);},_multi_send:function(r,n,t){var s=this,q=(typeof t.form.id==="string")?g.getElementById(t.form.id):t.form.id,m={method:q.getAttribute("method"),action:q.getAttribute("action"),target:q.getAttribute("target")},d=[];s._multi_setAttrs(q,r.id,n,t.method);if(t.data){var p=t.data;if(i.isObject(p)){p=a.QueryString.stringify(p);}d=s._addData(q,p);}if(t.json){d.push(s._addJSON(q,t.json));}if(t.timeout){s._multi_startTimeout(r,t);}q.submit();s.start(r,t);if(t.data){s._removeData(q,d);}s._resetAttrs(q,m);return{id:r.id,abort:function(){r.status=0;r.statusText="abort";if(a.one("#io-multi-response-"+r.id)){s._multi_destroy(r.id,t);s.end(r,t);}else{return false;}},isInProgress:function(){return a.one("#io-multi-response-"+r.id)?true:false;},io:s};}});var h=a.IO.prototype._init;a.IO.prototype._init=function(d){h.apply(this,arguments);this.publish("io:response",a.merge({broadcast:1},d));this.publish("io-trn:response",d);};var b=a.IO.prototype.upload;a.IO.prototype.upload=function(p,d,r){if(!r.multiresponse){return b.apply(this,arguments);}var q=this;YUI.Env.io_multi_response_callback[p.id]=function(o){if(!o){a.error("Callback "+p.id+" invoked without data.",null,"io");return;}if(r.timeout){q._clearTimeout(p.id);q._multi_startTimeout(p,r);}if(r.on&&r.on.response){p.c=o;q._evt("response",p,r);}};var m=encodeURIComponent("window.parent.YUI.Env.io_multi_response_callback["+p.id+"]");var n="callback="+m;if(!r.data){r.data=n;}else{if(i.isObject(r.data)){r.data.callback=m;}else{r.data=r.data+"&"+n;}}if(r.form&&!r.form.id){delete r.form;}k(p,r,q);return q._multi_send(p,d,r);};if(!YUI.Env.io_multi_response_callback){YUI.Env.io_multi_response_callback=[];}var c=a.io;a.io=function(d,m){if(m.multiresponse&&!m.form){m.form={id:l(m),upload:true};}else{if(m.multiresponse&&!m.form.upload){m.form.upload=true;}}c.call(this,d,m);};a.mix(a.io,c);},"gallery-2011.08.24-23-44",{requires:["io-upload-iframe"],optional:["json-stringify"]});