YUI.add("gallery-layout",function(a){function m(){m.superclass.constructor.apply(this,arguments);}m.NAME="pagelayout";m.FIT_TO_VIEWPORT=0;m.FIT_TO_CONTENT=1;m.ATTRS={mode:{value:m.FIT_TO_VIEWPORT,validator:function(o){return(o===m.FIT_TO_VIEWPORT||o===m.FIT_TO_CONTENT);}},minWidth:{value:73,validator:function(o){return(a.Lang.isNumber(o)&&o>0);}},minHeight:{value:44,validator:function(o){return(a.Lang.isNumber(o)&&o>0);}},stickyFooter:{value:false,validator:a.Lang.isBoolean},matchColumnHeights:{value:true,validator:a.Lang.isBoolean}};m.page_header_class="layout-hd";m.page_body_class="layout-bd";m.page_footer_class="layout-ft";m.module_rows_class="layout-module-row";m.module_cols_class="layout-module-col";m.module_class="layout-module";m.module_header_class="layout-m-hd";m.module_body_class="layout-m-bd";m.module_footer_class="layout-m-ft";m.not_managed_class="layout-not-managed";m.collapse_vert_nub_class="layout-vert-collapse-nub";m.collapse_left_nub_class="layout-left-collapse-nub";m.collapse_right_nub_class="layout-right-collapse-nub";m.expand_vert_nub_class="layout-vert-expand-nub";m.expand_left_nub_class="layout-left-expand-nub";m.expand_right_nub_class="layout-right-expand-nub";m.collapsed_vert_class="layout-collapsed-vert";m.collapsed_horiz_class="layout-collapsed-horiz";m.min_module_height=10;m.unmanaged_size=-1;var h=/\bFIT_TO_[A-Z_]+/,c=/(?:^|\s)height:([0-9]+)%/,f=/(?:^|\s)width:([0-9]+)%/,d=100,n={row:{module:"gallery-layout-rows",plugin:"PageLayoutRows",outer_size:c,inner_size:f},col:{module:"gallery-layout-cols",plugin:"PageLayoutCols",outer_size:f,inner_size:c}};function g(t,s){var r=a.map(t,function(w){if(w.hasClass(m.not_managed_class)){return m.unmanaged_size;}var v=w.get("className").match(s);return(v&&v.length?parseInt(v[1],10):0);});var u=a.reduce(r,[0,0],function(w,v){if(v>0){w[0]+=v;}else{if(v===0){w[1]++;}}return w;});var q=u[0],p=u[1];if(p>0){var o=Math.max((100-q)/p,10);r=a.map(r,function(v){return(v===0?o:v);});q=a.reduce(r,0,function(x,w,v){return(w<0?x:x+w);});}return a.map(r,function(v){return(v>0?v*(100/q):v);});}function j(){this.body_container.replaceClass("FIT_TO_(VIEWPORT|CONTENT)",this.get("mode")===m.FIT_TO_VIEWPORT?"FIT_TO_VIEWPORT":"FIT_TO_CONTENT");}function e(){if(!this.footer_container){return;}if(this.get("mode")===m.FIT_TO_VIEWPORT||this.get("stickyFooter")){this.body_container.get("parentNode").insertBefore(this.footer_container,this.body_container.next(function(o){return o.get("tagName").toLowerCase()!="script";}));}else{this.body_container.appendChild(this.footer_container);}}function b(){if(!this.layout_plugin||!this.body_container){return;}var s=this.single_module?a.PageLayout.FIT_TO_VIEWPORT:this.get("mode");var v=this.get("stickyFooter");this.body_container.setStyle("overflowX",s===a.PageLayout.FIT_TO_CONTENT?"auto":"hidden");this.body_container.setStyle("overflowY",s===a.PageLayout.FIT_TO_CONTENT?"scroll":"hidden");var u={w:this.body_container.get("winWidth"),h:this.body_container.get("winHeight")};var o=arguments[0]&&arguments[0].type=="resize";if(o&&(u.w===this.viewport.w&&u.h===this.viewport.h)){return;}this.viewport=u;this.fire("beforeReflow");var p=a.Node.emToPx(this.get("minWidth"));var q=Math.max(this.viewport.w,p);if(this.header_container){this.header_container.setStyle("width",q+"px");}this.body_container.setStyle("width",(q-this.body_horiz_mbp)+"px");if(this.footer_container){this.footer_container.setStyle("width",v?q+"px":"auto");}q=this.body_container.get("clientWidth")-this.body_horiz_mbp;this.viewport.bcw=this.body_container.get("clientWidth");var r=this.viewport.h;var t=a.Node.emToPx(this.get("minHeight"));if(s===a.PageLayout.FIT_TO_VIEWPORT&&r<t){r=t;a.one(document.documentElement).setStyle("overflowY","auto");}else{if(!window.console||!window.console.layout_force_viewport_scrollbars){a.one(document.documentElement).setStyle("overflowY","hidden");}}if(this.header_container){r-=this.header_container.get("offsetHeight");}if(this.footer_container&&(s===a.PageLayout.FIT_TO_VIEWPORT||v)){r-=this.footer_container.get("offsetHeight");}if(s===a.PageLayout.FIT_TO_VIEWPORT){var w=r-this.body_vert_mbp;}else{if(r<0){r=10+this.body_vert_mbp;}}this.body_container.setStyle("height",(r-this.body_vert_mbp)+"px");this.layout_plugin.resize(this,s,q,w);this.body_container.setStyle("visibility","visible");if(this.footer_container){this.footer_container.setStyle("visibility","visible");}a.Lang.later(100,this,k);}function k(){if(this.body_container.get("winWidth")!=this.viewport.w||this.body_container.get("winHeight")!=this.viewport.h||this.body_container.get("clientWidth")!=this.viewport.bcw){b.call(this);}else{this.fire("afterReflow");}}function l(q){var p=q.currentTarget;function o(u,r){var t=p.getAncestorByClassName(this.layout_plugin.collapse_classes[u]);if(t&&t.hasClass(r)){var s=this._analyzeModule(t);this.fire("beforeExpandModule",{bd:s.bd});t.removeClass(r);b.call(this);this.fire("afterExpandModule",{bd:s.bd});}}if(p.hasClass(m.expand_vert_nub_class)){o.call(this,"vert_parent_class",m.collapsed_vert_class);}else{o.call(this,"horiz_parent_class",m.collapsed_horiz_class);}}function i(p){var o=p.currentTarget;function q(u,r){var t=o.getAncestorByClassName(this.layout_plugin.collapse_classes[u]);if(t&&!t.hasClass(r)){var s=this._analyzeModule(t);this.fire("beforeCollapseModule",{bd:s.bd});t.addClass(r);b.call(this);this.fire("afterCollapseModule",{bd:s.bd});}}if(o.hasClass(m.collapse_vert_nub_class)){q.call(this,"vert_parent_class",m.collapsed_vert_class);}else{q.call(this,"horiz_parent_class",m.collapsed_horiz_class);}}a.extend(m,a.Base,{initializer:function(){this.viewport={w:0,h:0,bcw:0};var p=a.one("body").get("children");var q=p.filter("."+m.page_header_class);if(q.size()>1){throw Error("There must be at most one div with class "+m.page_header_class);}this.header_container=(q.isEmpty()?null:q.item(0));q=p.filter("."+m.page_body_class);if(q.size()!=1){throw Error("There must be exactly one div with class "+m.page_body_class);}this.body_container=q.item(0);
this.body_horiz_mbp=this.body_container.horizMarginBorderPadding();this.body_vert_mbp=this.body_container.vertMarginBorderPadding();var o=this.body_container.get("className").match(h);if(o&&o.length){this.set("mode",m[o[0]]);}q=p.filter("."+m.page_footer_class);if(q.size()>1){throw Error("There must be at most one div with class "+m.page_footer_class);}this.footer_container=(q.isEmpty()?null:q.item(0));a.one(a.config.win).on("resize",b,this);j.call(this);e.call(this);this.rescanBody();this.after("modeChange",function(){j.call(this);if(this.body_container){this.body_container.scrollTop=0;}e.call(this);b.call(this);});this.after("minWidthChange",b);this.after("minHeightChange",b);this.after("stickyFooterChange",function(){e.call(this);b.call(this);});this.after("matchColumnHeightsChange",b);},rescanBody:function(){a.detach("PageLayoutCollapse|click");this.body_info={outers:[],modules:[],outer_sizes:[],inner_sizes:[]};var p=this.body_container.all("div."+m.module_rows_class);var t=n.row;if(p.isEmpty()){p=this.body_container.all("div."+m.module_cols_class);t=n.col;}if(p.isEmpty()){throw Error("There must be at least one "+m.module_rows_class+" or "+m.module_cols_class+" inside "+m.page_body_class+".");}this.body_info.outers=p;var q="("+m.collapse_vert_nub_class+"|"+m.collapse_left_nub_class+"|"+m.collapse_right_nub_class+")";var r="("+m.expand_vert_nub_class+"|"+m.expand_left_nub_class+"|"+m.expand_right_nub_class+")";var s=this.body_info.outers.size();a.each(this.body_info.outers,function(w){var u=w.generateID();this.body_info.outer_sizes.push(100/s);var v=w.all("div."+m.module_class);if(v.isEmpty()){this.body_info.outers=[];this.body_info.modules=[];throw Error("There must be at least one "+m.module_class+" inside "+m.module_rows_class+".");}this.body_info.modules.push(v);a.each(v,function(y){var x=y.getFirstElementByClassName(q);if(x){a.on("PageLayoutCollapse|click",i,x,this);}x=y.getFirstElementByClassName(r);if(x){a.on("PageLayoutCollapse|click",l,x,this);}},this);this.body_info.inner_sizes.push(g(v,t.inner_size));},this);this.body_info.outer_sizes=g(this.body_info.outers,t.outer_size);this.single_module=false;if(this.body_info.outers.size()==1&&this.body_info.modules[0].size()==1){t=n.row;this.single_module=true;}var o=this;a.use(t.module,function(u){o.layout_plugin=u[t.plugin];j.call(o);b.call(o);});},getHeaderHeight:function(){return(this.header_container?this.header_container.get("offsetHeight"):0);},getHeaderContainer:function(){return this.header_container;},getBodyHeight:function(){return this.body_container.get("offsetHeight");},getBodyContainer:function(){return this.body_container;},getFooterHeight:function(){return(this.get("stickyFooter")&&this.footer_container?this.footer_container.get("offsetHeight"):0);},getFooterContainer:function(){return this.footer_container;},moduleIsCollapsed:function(p){var o="("+m.collapsed_horiz_class+"|"+m.collapses_vert_class+")";p=a.one(p);if(p.getFirstElementByClassName(this.layout_plugin.collapse_classes.collapse_parent_pattern)){p=p.get("parentNode");}return p.hasClass(o);},expandModule:function(q){q=a.one(q);var p=q.getFirstElementByClassName(m.expand_vert_nub_class);if(!p){var o="("+m.expand_left_nub_class+"|"+m.expand_right_nub_class+")";p=q.getFirstElementByClassName(o);}if(p){l.call(this,{currentTarget:p});}},collapseModule:function(p){p=a.one(p);var o=p.getFirstElementByClassName(m.collapse_vert_nub_class);if(!o){var q="("+m.collapse_left_nub_class+"|"+m.collapse_right_nub_class+")";o=p.getFirstElementByClassName(q);}if(o){i.call(this,{currentTarget:o});}},toggleModule:function(o){o=a.one(o);if(this.moduleIsCollapsed(o)){this.expandModule(o);}else{this.collapseModule(o);}},elementResized:function(o){o=a.one(o);if((this.header_container&&this.header_container.contains(o))||this.body_container.contains(o)||(this.footer_container&&this.footer_container.contains(o))){if(this.refresh_timer){this.refresh_timer.cancel();}var p=(new Date()).getTime();this.refresh_timer=a.later(d,this,function(){this.refresh_timer=null;var q=(new Date()).getTime();if(q>p+2*d){this.elementResized(o);}else{b.call(this);}});return true;}else{return false;}},_analyzeModule:function(p){var o={root:p,hd:null,bd:null,ft:null};var r=p.one("."+m.module_body_class);if(!r){return o;}var q=r.siblings().filter("."+m.module_body_class);q.unshift(r);o.bd=q.find(function(s){return(s.get("offsetWidth")>0);});if(!o.bd){o.bd=r;}if(o.bd){o.hd=o.bd.siblings().filter("."+m.module_header_class).item(0);o.ft=o.bd.siblings().filter("."+m.module_footer_class).item(0);}return o;},_setWidth:function(p,o){p.root.setStyle("width",o+"px");}});a.PageLayout=m;},"gallery-2012.03.23-18-00",{skinnable:true,optional:["gallery-layout-rows","gallery-layout-cols"],requires:["base","gallery-funcprog","gallery-node-optimizations","gallery-dimensions","gallery-nodelist-extras2"]});