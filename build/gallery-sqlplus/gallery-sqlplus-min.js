YUI.add("gallery-sqlplus",function(a){(function(g){var e=g.Lang,d,f=e.trim,b,c;c=function(h){c.superclass.constructor.call(this,h);};c.ATTRS={args:{value:["-MARKUP","HTML ON"],writeOnce:"initOnly"},command:{value:"sqlplus",writeOnce:"initOnly"},connection:{setter:function(h){if(e.isObject(h)){return h.user+"/"+h.password+"@"+h.host+"/"+h.database;}return h;},writeOnce:"initOnly"},prompt:{value:"SQL&gt; "},ready:{readOnly:true,value:false},sqlPlus:{readOnly:true}};c.NAME="SqlPlus";g.extend(c,g.Base,{execute:function(j,h,i){return this.write(j+"\n",function(l){l.append('<span id="prompt">'+this.get("prompt")+"</span>");var m=l.one("#prompt"),k;if(m){k=m.remove().get("text");}m=l.one("pre");if(m){h.call(i,f(k&&l.get("text").replace(new RegExp(k,"g"),"")||l.get("text")));return;}m=l.one("table");if(m){d(m,h,i);return;}if(l.get("text").indexOf("no rows selected")===-1){h.call(i,null,parseInt(f(k&&l.get("text").replace(new RegExp(k,"g"),"")||l.get("text")),10));return;}h.call(i,null,[]);},this);},initializer:function(){this.publish("exit",{defaultFn:function(){this.destroy();},fireOnce:true});this.publish("response");var i="",h=new g.ChildProcess({args:this.get("args").concat(this.get("connection")),command:this.get("command"),stderrEncoding:"utf8",stdoutEncoding:"utf8"});h.on("exit",function(j){this.fire("exit",{code:j.code,signal:j.signal});},this);h.on("stdout",function(k){var m=k.data,j=this.get("prompt"),l=-j.length;i+=m;if(m.slice(l)===j){i=i.slice(0,l);if(i){this.fire("response",{data:i});i="";}this._set("ready",true);}},this);this._set("sqlPlus",h);this.write("SET DEFINE OFF\n");this.write("SET LONG 2000000000\n");this.write("SET PAGESIZE 50000\n");},write:function(k,h,j){if(this.get("ready")){b.call(this,k,h,j);}else{var i=this.on("readyChange",function(l){if(l.newVal){this.write(k,h,j);i.detach();}},this);}return this;}});d=function(l,i,k){var h=[],j=l.one("tr:first-child").remove(),n=l.one("tr:first-child"),m=n&&n.all("td");l.all("th").remove();l.all("tr:empty").remove();g.each(j.all("th"),function(q,o){var p=m&&m.item(o);h.push({key:f(q.get("text")),locator:"td["+(o+1)+"]",parser:function(r){r=f(r);if(r==="&nbsp;"){return null;}if(p&&p.hasAttribute("align")){return +r;}else{return r;}}});});i.call(k,null,g.DataSchema.XML.apply({resultFields:h,resultListLocator:"tr"},l.getDOMNode()).results);};b=function(j,h,i){this.get("sqlPlus").write(j);this._set("ready",false);if(!h){return;}this.onceAfter("response",function(k){YUI().use("node","nodejs-dom","selector-css3",function(l){h.call(i,l.one("body").setContent(k.data));});});};g.SqlPlus=c;}(a));},"@VERSION@",{requires:["dataschema-xml","gallery-child-process"],skinnable:false});